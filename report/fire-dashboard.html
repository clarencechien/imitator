<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIRE 動態提領引擎 (FDE-60)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }
        body {
            background-color: #0f172a; /* slate-900 */
        }
        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -8px; /* You need to specify a margin in Chrome, but in Firefox and IE it is automatic */
            box-shadow: 0 0 2px 0px rgba(0,0,0,0.5);
        }
        input[type=range]::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border: none;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 2px 0px rgba(0,0,0,0.5);
        }
        input[type=range]:focus {
            outline: none; 
        }
        /* Track styling */
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: transparent; 
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- Icon Components ---
        const IconWrapper = ({ children, className }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" 
                height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const AlertTriangle = ({ className }) => (
            <IconWrapper className={className}>
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                <path d="M12 9v4" />
                <path d="M12 17h.01" />
            </IconWrapper>
        );

        const TrendingUp = ({ className }) => (
            <IconWrapper className={className}>
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                <polyline points="17 6 23 6 23 12" />
            </IconWrapper>
        );

        const DollarSign = ({ className }) => (
            <IconWrapper className={className}>
                <line x1="12" x2="12" y1="2" y2="22" />
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
            </IconWrapper>
        );

        const PieChart = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83" />
                <path d="M22 12A10 10 0 0 0 12 2v10z" />
            </IconWrapper>
        );

        const Activity = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
            </IconWrapper>
        );

        const ShieldCheck = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" />
                <path d="m9 12 2 2 4-4" />
            </IconWrapper>
        );

        const ExternalLink = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                <polyline points="15 3 21 3 21 9" />
                <line x1="10" x2="21" y1="14" y2="3" />
            </IconWrapper>
        );

        const ChevronDown = ({ className }) => (
            <IconWrapper className={className}>
                <path d="m6 9 6 6 6-6" />
            </IconWrapper>
        );

        const ChevronUp = ({ className }) => (
            <IconWrapper className={className}>
                <path d="m18 15-6-6-6 6" />
            </IconWrapper>
        );

        const BookOpen = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
            </IconWrapper>
        );

        const CheckCircle = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </IconWrapper>
        );

        const XCircle = ({ className }) => (
            <IconWrapper className={className}>
                <circle cx="12" cy="12" r="10" />
                <path d="m15 9-6 6" />
                <path d="m9 9 6 6" />
            </IconWrapper>
        );

        const Settings = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                <circle cx="12" cy="12" r="3" />
            </IconWrapper>
        );

        // --- Main Component ---
        function FireDashboard() {
            // --- 狀態變數 ---
            const [totalAssets, setTotalAssets] = useState(30000000);
            const [cape, setCape] = useState(35);
            // 修正：預設債券部位改為 600 萬 (即 20% of 3000 萬)，符合 80/20 預設配置
            const [currentBondHoldings, setCurrentBondHoldings] = useState(6000000);
            const [isDetailsOpen, setIsDetailsOpen] = useState(false); 
            const [isConfigOpen, setIsConfigOpen] = useState(false); // 配置設定預設收合
            
            // 目標配置 (預設 80% 股票 / 20% 債券)
            const [targetBondRatio, setTargetBondRatio] = useState(20);

            // 系統常數
            const CONST_A = 1.75;
            const CONST_B = 0.5;

            // --- 安全數值轉換 ---
            const valTotalAssets = totalAssets === '' ? 0 : totalAssets;
            const valCape = cape === '' ? 0 : cape;
            const valBondHoldings = currentBondHoldings === '' ? 0 : currentBondHoldings;
            
            // --- 計算邏輯 ---
            const effectiveCape = valCape > 0 ? valCape : Infinity;
            const swr = CONST_A + (CONST_B * (1 / effectiveCape)) * 100;
            const swrDisplay = swr.toFixed(2);
            
            const annualBudget = valTotalAssets * (swr / 100);
            const quarterlyWithdrawal = annualBudget / 4;
            const monthlyBudget = annualBudget / 12;
            
            const currentEquityHoldings = valTotalAssets - valBondHoldings;
            
            // 比率計算
            const equityRatio = valTotalAssets > 0 ? (currentEquityHoldings / valTotalAssets) * 100 : 0;
            const bondRatio = valTotalAssets > 0 ? (valBondHoldings / valTotalAssets) * 100 : 0;
            
            // 存糧年限
            let bondRunwayYears = "0.0";
            if (annualBudget > 0) {
                bondRunwayYears = (valBondHoldings / annualBudget).toFixed(1);
            } else if (valBondHoldings > 0) {
                bondRunwayYears = "∞";
            }
            
            // 建議邏輯 (基於目標配置)
            let actionType = "HOLD"; // SELL_BOND, SELL_STOCK
            if (bondRatio > targetBondRatio) {
                // 目前債券比重 > 目標 -> 賣債券
                actionType = "SELL_BOND";
            } else {
                // 目前債券比重 <= 目標 -> 賣股票
                actionType = "SELL_STOCK";
            }

            const isAusterity = swr < 3.0;
            
            const formatCurrency = (num) => {
                if (!Number.isFinite(num)) return "$0";
                return new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(num);
            };

            const formatChineseUnit = (num) => {
                const n = Number(num);
                if (!n) return ""; 
                if (n >= 100000000) {
                    return (n / 100000000).toFixed(2) + " 億";
                } else if (n >= 10000) {
                    return (n / 10000).toFixed(0) + " 萬";
                }
                return n;
            };

            const handleInputChange = (setter) => (e) => {
                const val = e.target.value;
                setter(val === '' ? '' : Number(val));
            };

            // 修正：滑桿改為控制「股票比例」，使拖曳方向與視覺直覺一致
            // sliderValue (Stock %) = 100 - targetBondRatio
            const sliderStockValue = 100 - targetBondRatio;
            
            const handleSliderChange = (e) => {
                const newStockRatio = Number(e.target.value);
                setTargetBondRatio(100 - newStockRatio);
            };

            return (
                <div className="min-h-screen bg-slate-900 p-6 md:p-10 font-sans text-slate-200 text-lg font-medium">
                    <div className="max-w-5xl mx-auto space-y-8">
                        
                        {/* Header */}
                        <header className="bg-slate-800 p-8 rounded-2xl shadow-lg border border-slate-700 flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div>
                                <h1 className="text-3xl md:text-4xl font-extrabold text-white tracking-tight">FIRE 動態提領引擎</h1>
                                <p className="text-slate-300 text-base md:text-lg mt-2 font-semibold">基於 Bigern CAPE 估值調整模型 (FDE-60)</p>
                            </div>
                            <div className="flex gap-2">
                                <span className="px-4 py-2 bg-slate-700 text-slate-100 rounded-full text-sm font-bold border border-slate-600 shadow-sm">
                                    v1.8 Default 80/20
                                </span>
                            </div>
                        </header>

                        {/* 輸入區塊 */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {/* 1. 總資產 */}
                            <div className="bg-slate-800 p-6 rounded-2xl shadow-md border border-slate-700 flex flex-col justify-center group hover:border-blue-500/50 transition-colors">
                                <label className="block text-lg font-bold text-slate-300 mb-3">總資產市值 (NTD)</label>
                                <div className="relative">
                                    <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-blue-400 transition-colors">
                                        <DollarSign className="w-6 h-6" />
                                    </div>
                                    <input 
                                        type="number" 
                                        value={totalAssets}
                                        onChange={handleInputChange(setTotalAssets)}
                                        placeholder="0"
                                        className="w-full pl-12 pr-4 py-4 bg-slate-900 border border-slate-600 text-white text-2xl rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all font-bold placeholder-slate-700"
                                    />
                                </div>
                                <p className="text-right text-base text-blue-400 mt-2 font-bold h-6">
                                    {formatChineseUnit(totalAssets)}
                                </p>
                            </div>

                            {/* 2. CAPE 指數 */}
                            <div className="bg-slate-800 p-6 rounded-2xl shadow-md border border-slate-700 flex flex-col justify-center relative overflow-hidden group hover:border-blue-500/50 transition-colors">
                                <div className="flex justify-between items-center mb-3">
                                    <label className="block text-lg font-bold text-slate-300">當前 CAPE 指數</label>
                                    <a href="https://www.multpl.com/shiller-pe" target="_blank" rel="noreferrer" className="flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 hover:underline transition-colors font-semibold">
                                        查詢 Multpl <ExternalLink className="w-4 h-4" />
                                    </a>
                                </div>
                                <div className="relative">
                                    <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-blue-400 transition-colors">
                                        <Activity className="w-6 h-6" />
                                    </div>
                                    <input 
                                        type="number" 
                                        value={cape}
                                        onChange={handleInputChange(setCape)}
                                        placeholder="0"
                                        className="w-full pl-12 pr-4 py-4 bg-slate-900 border border-slate-600 text-white text-2xl rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all font-bold placeholder-slate-700"
                                    />
                                </div>
                                <div className="flex gap-2 mt-3 justify-end">
                                    <button onClick={() => setCape(17)} className="px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-bold text-slate-200 transition-colors" title="歷史平均">
                                        Avg (17)
                                    </button>
                                    <button onClick={() => setCape(44)} className="px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-bold text-slate-200 transition-colors" title="網路泡沫高點">
                                        High (44)
                                    </button>
                                    <button onClick={() => setCape(13)} className="px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-bold text-slate-200 transition-colors" title="金融海嘯低點">
                                        Low (13)
                                    </button>
                                </div>
                            </div>

                            {/* 3. 債券部位 */}
                            <div className="bg-slate-800 p-6 rounded-2xl shadow-md border border-slate-700 flex flex-col justify-center group hover:border-blue-500/50 transition-colors">
                                <label className="block text-lg font-bold text-slate-300 mb-3">目前債券部位 (NTD)</label>
                                <div className="relative">
                                    <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-blue-400 transition-colors">
                                        <PieChart className="w-6 h-6" />
                                    </div>
                                    <input 
                                        type="number" 
                                        value={currentBondHoldings}
                                        onChange={handleInputChange(setCurrentBondHoldings)}
                                        placeholder="0"
                                        className="w-full pl-12 pr-4 py-4 bg-slate-900 border border-slate-600 text-white text-2xl rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all font-bold placeholder-slate-700"
                                    />
                                </div>
                                <p className="text-right text-base text-blue-400 mt-2 font-bold h-6">
                                    {formatChineseUnit(currentBondHoldings)}
                                </p>
                            </div>
                        </div>

                        {/* 核心儀表板 */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            
                            {/* 1. 提領預算卡片 */}
                            <div className={`bg-slate-800 p-8 rounded-2xl shadow-md border-l-8 ${isAusterity ? 'border-l-red-500' : 'border-l-green-500'} border-y border-r border-slate-700 relative overflow-hidden`}>
                                <h2 className="text-2xl font-extrabold text-white flex items-center mb-6">
                                    <TrendingUp className="w-8 h-8 mr-3 text-slate-300" />
                                    年度提領計畫
                                </h2>
                                
                                <div className="space-y-6">
                                    <div className="flex justify-between items-end pb-4 border-b border-slate-700">
                                        <span className="text-slate-300 text-lg font-bold">計算 SWR (安全提領率)</span>
                                        <div className="text-right">
                                            <span className={`text-5xl font-extrabold ${isAusterity ? 'text-red-400' : 'text-green-400'}`}>
                                                {swrDisplay}%
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4 pb-4 border-b border-slate-700">
                                        <div>
                                            <span className="text-slate-300 text-sm block mb-1 font-bold">本年度總預算</span>
                                            <span className="text-2xl font-extrabold text-white">
                                                {formatCurrency(annualBudget)}
                                            </span>
                                        </div>
                                        <div className="text-right">
                                            <span className="text-slate-300 text-sm block mb-1 font-bold">換算月薪</span>
                                            <span className="text-2xl font-extrabold text-slate-200">
                                                {formatCurrency(monthlyBudget)}
                                            </span>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900/60 p-6 rounded-xl border border-slate-700/50 text-center">
                                        <p className="text-sm text-slate-400 uppercase tracking-wide mb-2 font-extrabold">本季應提領金額 (1/4/7/10月)</p>
                                        <p className="text-4xl md:text-5xl font-black text-blue-400 tracking-tight">
                                            {formatCurrency(quarterlyWithdrawal)}
                                        </p>
                                    </div>

                                    {isAusterity && (
                                        <div className="flex items-start gap-4 p-4 bg-red-900/20 border border-red-900/30 text-red-200 text-base rounded-xl">
                                            <AlertTriangle className="w-6 h-6 shrink-0 text-red-400 mt-1" />
                                            <div>
                                                <strong className="text-red-300 text-lg block mb-1 font-extrabold">樽節警告 (Austerity Warning)</strong>
                                                <p className="text-red-200/90 leading-relaxed font-semibold">
                                                    CAPE 過高導致 SWR 低於 3%。建議啟動 Barista FIRE 或縮減非必要開支。
                                                </p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* 2. 資產配置與滑翔路徑 */}
                            <div className="bg-slate-800 p-8 rounded-2xl shadow-md border border-slate-700">
                                <h2 className="text-2xl font-extrabold text-white flex items-center mb-6">
                                    <PieChart className="w-8 h-8 mr-3 text-slate-300" />
                                    資產配置狀態 (Glidepath)
                                </h2>

                                <div className="space-y-6">
                                    <div className="grid grid-cols-2 gap-6">
                                        <div className="text-center p-5 bg-blue-900/20 border border-blue-800/30 rounded-xl">
                                            <p className="text-sm font-extrabold text-blue-300 mb-2 uppercase">股票 (VT)</p>
                                            <p className="text-4xl font-extrabold text-blue-100">{equityRatio.toFixed(1)}%</p>
                                            <p className="text-base font-bold text-slate-300 mt-1">{formatCurrency(currentEquityHoldings)}</p>
                                        </div>
                                        <div className="text-center p-5 bg-amber-900/20 border border-amber-800/30 rounded-xl relative">
                                            <p className="text-sm font-extrabold text-amber-300 mb-2 uppercase">債券 (VGIT)</p>
                                            <p className="text-4xl font-extrabold text-amber-100">{bondRatio.toFixed(1)}%</p>
                                            <p className="text-base font-bold text-slate-300 mt-1">{formatCurrency(currentBondHoldings)}</p>
                                        </div>
                                    </div>
                                    
                                    <div className="flex items-center justify-between bg-slate-700/40 p-5 rounded-lg border border-slate-600/50">
                                        <div className="flex items-center gap-3 text-slate-200">
                                            <ShieldCheck className="w-6 h-6 text-green-400" />
                                            <span className="text-base font-bold">目前債券存量 (Runway)</span>
                                        </div>
                                        <div className="text-right">
                                            <span className={`text-2xl font-black ${Number(bondRunwayYears) < 2 && Number(bondRunwayYears) !== 0 ? 'text-red-400' : 'text-white'}`}>
                                                {bondRunwayYears} 年
                                            </span>
                                            <span className="text-sm font-bold text-slate-400 ml-2">生活費</span>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900 text-slate-200 p-6 rounded-xl shadow-inner border border-slate-700">
                                        <h3 className="text-base font-extrabold text-slate-300 uppercase mb-4 tracking-wider">本季執行建議 (SOP)</h3>
                                        <div className="space-y-4 text-lg">
                                            <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-1">
                                                <span className="text-slate-400 font-bold">1. 提領需求：</span>
                                                <span className="font-mono text-xl text-yellow-400 font-black">{formatCurrency(quarterlyWithdrawal)}</span>
                                            </div>
                                            <div className="flex flex-col sm:flex-row justify-between sm:items-center gap-1">
                                                <span className="text-slate-400 font-bold">2. 賣出標的：</span>
                                                {actionType === "SELL_BOND" ? (
                                                    <span className="font-extrabold text-xl text-green-400">優先賣出 VGIT (債券)</span>
                                                ) : (
                                                    <span className="font-extrabold text-xl text-blue-400">債券不足，賣出 VT (股票)</span>
                                                )}
                                            </div>
                                            <div className="text-base text-slate-400 mt-4 pt-4 border-t border-slate-800 leading-relaxed font-semibold">
                                                {actionType === "SELL_BOND" ? (
                                                    <p>* 原因：目前債券 <span className="text-amber-400">{bondRatio.toFixed(1)}%</span> 高於目標 <span className="text-slate-300">{targetBondRatio}%</span>。請執行滑翔/再平衡，消耗債券。</p>
                                                ) : (
                                                    <p>* 原因：目前債券 <span className="text-amber-400">{bondRatio.toFixed(1)}%</span> 低於目標 <span className="text-slate-300">{targetBondRatio}%</span>。請保留債券安全墊，改賣股票。</p>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* 目標配置設定 Widget (預設收合) */}
                        <div className="bg-slate-800 rounded-2xl shadow-lg border border-slate-700 overflow-hidden transition-all duration-300">
                            <button 
                                onClick={() => setIsConfigOpen(!isConfigOpen)}
                                className="w-full p-6 flex items-center justify-between bg-slate-800 hover:bg-slate-750 transition-colors"
                            >
                                <div className="flex items-center gap-3">
                                    <Settings className="w-6 h-6 text-purple-400" />
                                    <h3 className="text-xl font-extrabold text-white">資產配置目標設定</h3>
                                </div>
                                {isConfigOpen ? <ChevronUp className="w-6 h-6 text-slate-400" /> : <ChevronDown className="w-6 h-6 text-slate-400" />}
                            </button>
                            
                            {isConfigOpen && (
                                <div className="p-8 pt-0 border-t border-slate-700 bg-slate-800/50">
                                    <div className="mt-6 mb-6">
                                        <p className="text-slate-300 mb-6 font-medium">設定您最終希望維持的股債比例。系統會根據此目標建議您賣出股票或債券進行再平衡。<br/>
                                        <span className="text-sm text-slate-400">(預設建議：80% 股票 / 20% 債券)</span></p>
                                        
                                        <div className="bg-slate-900/80 p-6 rounded-xl border border-slate-600/50">
                                            <div className="flex justify-between mb-4 font-bold">
                                                {/* 顯示目前滑桿對應的數值 */}
                                                <span className="text-blue-300">股票 (VT): {sliderStockValue}%</span>
                                                <span className="text-amber-300">債券 (VGIT): {targetBondRatio}%</span>
                                            </div>
                                            
                                            <input 
                                                type="range" 
                                                min="0" 
                                                max="100" 
                                                step="5"
                                                value={sliderStockValue} 
                                                onChange={handleSliderChange}
                                                className="w-full h-4 bg-slate-700 rounded-lg appearance-none cursor-pointer"
                                                style={{
                                                    backgroundImage: `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${sliderStockValue}%, #d97706 ${sliderStockValue}%, #d97706 100%)`
                                                }}
                                            />
                                            <div className="flex justify-between text-xs text-slate-500 mt-2 font-mono">
                                                <span>0/100</span>
                                                <span>20/80</span>
                                                <span>40/60</span>
                                                <span>60/40</span>
                                                <span>80/20</span>
                                                <span>100/0</span>
                                            </div>
                                            <div className="flex justify-between text-xs text-slate-500 mt-1 font-mono">
                                                <span>(股/債)</span>
                                                <span></span>
                                                <span></span>
                                                <span></span>
                                                <span></span>
                                                <span>(股/債)</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* 詳細說明書 Widget (預設收合) */}
                        <div className="bg-slate-800 rounded-2xl shadow-lg border border-slate-700 overflow-hidden transition-all duration-300">
                            <button 
                                onClick={() => setIsDetailsOpen(!isDetailsOpen)}
                                className="w-full p-6 flex items-center justify-between bg-slate-800 hover:bg-slate-750 transition-colors"
                            >
                                <div className="flex items-center gap-3">
                                    <BookOpen className="w-6 h-6 text-blue-400" />
                                    <h3 className="text-xl font-extrabold text-white">完整提領計畫說明書 & SOP</h3>
                                </div>
                                {isDetailsOpen ? <ChevronUp className="w-6 h-6 text-slate-400" /> : <ChevronDown className="w-6 h-6 text-slate-400" />}
                            </button>
                            
                            {isDetailsOpen && (
                                <div className="p-8 pt-0 border-t border-slate-700 bg-slate-800/50">
                                    {/* TL;DR */}
                                    <div className="mb-8 bg-slate-900/50 p-6 rounded-xl border-l-4 border-blue-500 mt-6">
                                        <h4 className="text-lg font-black text-blue-300 mb-2 uppercase tracking-wide">TL;DR 核心懶人包</h4>
                                        <p className="text-slate-200 leading-relaxed">
                                            每年 1/1 計算今年能花多少錢，每季 (1/4/7/10月) 提領一次。
                                            <br />
                                            原則：<strong>優先賣債券 (VGIT)</strong>，直到債券比例降至設定目標 (如 20%)。之後進入再平衡模式：股漲賣股，股跌賣債。
                                        </p>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                                        {/* Do's */}
                                        <div>
                                            <h4 className="flex items-center gap-2 text-green-400 font-black text-lg mb-4">
                                                <CheckCircle className="w-6 h-6" />
                                                Do (必做清單)
                                            </h4>
                                            <ul className="space-y-3">
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">每年 1/1 登入更新「總資產」與「CAPE 指數」，算出年度預算。</span>
                                                </li>
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">優先賣出 <strong className="text-white">VGIT (美國公債)</strong> 執行滑翔路徑。</span>
                                                </li>
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">當債券比例降至 20% 後，開始執行 80/20 再平衡。</span>
                                                </li>
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">若 CAPE &gt; 30，要有心理準備該年預算會縮水，考慮減少旅遊等非必要支出。</span>
                                                </li>
                                            </ul>
                                        </div>

                                        {/* Don'ts */}
                                        <div>
                                            <h4 className="flex items-center gap-2 text-red-400 font-black text-lg mb-4">
                                                <XCircle className="w-6 h-6" />
                                                Don't (絕對禁止)
                                            </h4>
                                            <ul className="space-y-3">
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">禁止買 <strong className="text-red-300">BND/公司債</strong>。避險部位必須是純公債，否則股災時會跟著跌。</span>
                                                </li>
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">禁止在 1 月一次提領整年份現金 (會造成現金拖累，降低報酬)。</span>
                                                </li>
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">禁止在股市大跌時恐慌賣出 VT (股票)。這時候是債券發揮作用的時候。</span>
                                                </li>
                                                <li className="flex gap-3 items-start">
                                                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full mt-2.5 shrink-0"></span>
                                                    <span className="text-slate-300">禁止在台灣帳戶保留超過 6 個月的生活費。</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                    {/* 詳細步驟 */}
                                    <div>
                                        <h4 className="text-lg font-black text-white mb-4 border-b border-slate-700 pb-2">詳細執行步驟 (SOP)</h4>
                                        <div className="space-y-6">
                                            <div>
                                                <h5 className="text-blue-300 font-bold text-base mb-2">Step 1: 年度健檢 (每年 1 月 1 日)</h5>
                                                <p className="text-slate-400 text-base leading-relaxed">
                                                    打開此儀表板，輸入 12/31 收盤後的總資產。去 Multpl.com 查最新的 CAPE 指數。
                                                    系統會告訴你今年可以花多少錢。如果數字比去年少，請調整心態，這是為了保護你的本金能撐 60 年。
                                                </p>
                                            </div>
                                            <div>
                                                <h5 className="text-blue-300 font-bold text-base mb-2">Step 2: 季度提領 (1/4/7/10 月)</h5>
                                                <p className="text-slate-400 text-base leading-relaxed">
                                                    登入美股券商。優先使用配息。看系統建議：「賣債券」還是「賣股票」。
                                                    若系統顯示債券不足目標，則賣出股票。將美金匯回台灣。記得，操作完就關掉網頁，不要去看股票漲跌。
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FireDashboard />);
    </script>
</body>
</html>
