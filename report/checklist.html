<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…è¡Œå¿…å‚™æ¸…å–®</title>

    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ—…è¡Œæ¸…å–®">
    
    <!-- iOS Icon -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/7893/7893979.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- SortableJS (ç”¨æ–¼æ‹–æ‹‰åŠŸèƒ½) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <!-- PWA Manifest -->
    <script>
        const manifest = {
            "name": "æ—…è¡Œå¿…å‚™æ¸…å–®",
            "short_name": "æ—…è¡Œæ¸…å–®",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#2563eb",
            "icons": [{
                "src": "https://cdn-icons-png.flaticon.com/512/7893/7893979.png",
                "sizes": "512x512",
                "type": "image/png"
            }]
        };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = url;
        document.head.appendChild(link);
    </script>

    <style>
        /* é˜²åç™½èˆ‡è§¸æ§å„ªåŒ– */
        * {
            -webkit-tap-highlight-color: transparent !important;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        input {
            -webkit-user-select: text !important;
            user-select: text !important;
        }

        body {
            overscroll-behavior-y: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6;
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .safe-padding {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* æ‹–æ‹‰æ™‚çš„æ¨£å¼ */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #e5e7eb;
        }
        .sortable-drag {
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: scale(1.02);
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden flex flex-col safe-padding">

    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow-md z-10 shrink-0">
        <div class="flex justify-between items-center mb-3">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <span>âœˆï¸</span> æ—…è¡Œæ¸…å–®
            </h1>
            <button onclick="confirmReset()" class="p-2 active:opacity-50 transition-opacity">
                â†º é‡ç½®
            </button>
        </div>
        <!-- Progress Bar -->
        <div class="w-full bg-blue-800 rounded-full h-2 mb-1">
            <div id="progressBar" class="bg-white h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
        <div class="flex justify-between text-xs text-blue-100 mt-1">
            <span id="progressText">0/0</span>
            <span id="progressPercent">0%</span>
        </div>
    </header>

    <!-- Input -->
    <div class="p-3 bg-white border-b shrink-0">
        <form onsubmit="addItem(event)" class="flex gap-2">
            <input type="text" id="newInput" placeholder="æ–°å¢é …ç›®..." 
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:border-blue-500 bg-gray-50 text-base shadow-sm">
            <button type="submit" class="bg-blue-600 text-white w-12 rounded-lg font-bold text-xl active:bg-blue-700 flex items-center justify-center">
                +
            </button>
        </form>
    </div>

    <!-- List -->
    <div id="listContainer" class="flex-1 overflow-y-auto hide-scrollbar bg-white pb-20">
        <!-- Javascript will populate this -->
    </div>

    <script>
        // é è¨­è³‡æ–™
        const DEFAULT_ITEMS = [
            "é«®å¤¾&é«®ç®", "æ´—é¢ä¹³", "æ´—åˆ·åˆ·", "æ²æµ´ä¹³ã€æ´—é«®ç²¾ã€æ½¤é«®ä¹³",
            "ç‰™åˆ·ã€ç‰™è†ã€ç‰™ç·š", "ç¶­æŒå™¨", "éš±å½¢çœ¼é¡ã€çœ¼é¡&çœ¼é¡ç›’", "æ³¡æ¾¡éŒ ",
            "èº«é«”ä¹³æ¶²", "å‡¡å£«æ—", "è­·æ‰‹éœœ", "è‡‰éƒ¨ä¿é¤Šå“ã€é˜²æ›¬ã€åŒ–å¦å“",
            "é¢è†œ", "é¡å­", "æ¢³å­", "å¹é¢¨æ©Ÿ", "è¡›ç”Ÿç´™", "æ¿•ç´™å·¾", "å£ç½©",
            "è­·å¢Š&è¡›ç”Ÿæ£‰", "è¡£ç‰©ã€å…§è¡£è¤²ã€è¥ªå­ã€ç¡è¡£", "é«’è¡£å¡‘è† è¢‹",
            "é£¾å“", "é›¨å‚˜", "ä¸­è—¥", "å……é›»å™¨ã€è¡Œå‹•é›»æº", "ä¿å¥&è—¥å“",
            "ä¿æº«ç“¶", "æ³³è£", "è­·ç…§&å½±æœ¬", "å¤¾éˆè¢‹&ä¿é®®è†œ", "å‚™ç”¨æè¢‹",
            "æ¯›å·¾", "æ›¬è¡£å¤¾", "ç¶²çƒğŸ¾", "ç™¼ç†±è¡£", "å¸½å­/åœå·¾/æ‰‹å¥—", "é˜²éœé›»æ‰‹ç’°"
        ].map((t, i) => ({ id: `d-${i}`, text: t, checked: false }));

        let items = [];
        let sortableInstance = null; // å„²å­˜ Sortable å¯¦ä¾‹

        function init() {
            const saved = localStorage.getItem('travel-list-drag');
            items = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(DEFAULT_ITEMS));
            render();
        }

        function save() {
            localStorage.setItem('travel-list-drag', JSON.stringify(items));
            renderStats();
        }

        function render() {
            const container = document.getElementById('listContainer');
            
            // å¦‚æœæ¸…å–®æ˜¯ç©ºçš„
            if (items.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 mt-20">æ¸…å–®æ˜¯ç©ºçš„</div>';
                renderStats();
                return;
            }

            let html = '<ul class="divide-y divide-gray-100">';
            items.forEach((item) => {
                const checkedClass = item.checked ? 'bg-blue-500 border-blue-500' : 'border-gray-300';
                const textClass = item.checked ? 'text-gray-400 line-through' : 'text-gray-800';
                const bgClass = item.checked ? 'bg-gray-50' : 'bg-white';
                const checkIcon = item.checked ? '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : '';

                html += `
                <li class="flex items-center ${bgClass} transition-colors duration-150" data-id="${item.id}">
                    
                    <!-- 1. æ‹–æ‹‰æŠŠæ‰‹ (é˜²èª¤è§¸é—œéµï¼šåªæœ‰æŒ‰é€™è£¡æ‰èƒ½æ‹–) -->
                    <div class="drag-handle p-4 text-gray-300 cursor-move active:text-blue-500 touch-manipulation">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
                    </div>

                    <!-- 2. é»æ“Šå‹¾é¸å€åŸŸ -->
                    <div class="flex-1 flex items-center py-4 pr-4 cursor-pointer" onclick="toggle('${item.id}')">
                        <div class="w-6 h-6 rounded border-2 mr-4 flex items-center justify-center transition-colors ${checkedClass}">
                            ${checkIcon}
                        </div>
                        <span class="text-lg ${textClass}">${item.text}</span>
                    </div>
                    
                    <!-- 3. åˆªé™¤æŒ‰éˆ• -->
                    <button onclick="del('${item.id}')" class="p-4 text-gray-300 active:text-red-500 flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </li>
                `;
            });
            html += '</ul>';
            container.innerHTML = html;
            renderStats();

            // é‡æ–°åˆå§‹åŒ– SortableJS
            initSortable();
        }

        function initSortable() {
            const el = document.querySelector('#listContainer ul');
            if (!el) return;

            // å¦‚æœå·²ç¶“æœ‰å¯¦ä¾‹ï¼Œå…ˆéŠ·æ¯€èˆŠçš„
            if (sortableInstance) {
                sortableInstance.destroy();
            }

            // å»ºç«‹æ–°çš„ Sortable å¯¦ä¾‹
            sortableInstance = Sortable.create(el, {
                handle: '.drag-handle', // æŒ‡å®šåªæœ‰æŒ‰é€™å€‹ class æ‰èƒ½æ‹–æ‹‰
                animation: 200,         // å‹•ç•«æ¯«ç§’æ•¸
                delay: 0,               // æ‰‹æ©Ÿä¸Šç«‹å³åæ‡‰
                ghostClass: 'sortable-ghost', // æ‹–æ‹‰æ™‚åŸæœ¬ä½ç½®çš„æ¨£å¼
                dragClass: 'sortable-drag',   // æ‹–æ‹‰ä¸­çš„ç‰©ä»¶æ¨£å¼
                onEnd: function (evt) {
                    // æ‹–æ‹‰çµæŸå¾Œï¼ŒåŒæ­¥æ›´æ–° Javascript é™£åˆ—é †åº
                    const item = items.splice(evt.oldIndex, 1)[0]; // æ‹¿å‡ºèˆŠä½ç½®çš„é …ç›®
                    items.splice(evt.newIndex, 0, item);           // æ’å…¥åˆ°æ–°ä½ç½®
                    save(); // å­˜æª”
                }
            });
        }

        function renderStats() {
            const total = items.length;
            const completed = items.filter(i => i.checked).length;
            const percent = total === 0 ? 0 : Math.round((completed / total) * 100);
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressText').innerText = `å·²å®Œæˆ ${completed}/${total}`;
            document.getElementById('progressPercent').innerText = `${percent}%`;
        }

        function toggle(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.checked = !item.checked;
                save();
                // é€™è£¡æˆ‘å€‘ä¸å‘¼å«å®Œæ•´çš„ render()ï¼Œåªæ›´æ–°è©²é …ç›®çš„ class
                // é€™æ¨£å¯ä»¥é¿å…æ‹–æ‹‰å¥—ä»¶å› ç‚º DOM é‡ç¹ªè€Œé–ƒçˆ
                render(); 
            }
        }

        function addItem(e) {
            e.preventDefault();
            const input = document.getElementById('newInput');
            const text = input.value.trim();
            if (!text) return;
            items.unshift({ id: 'u-' + Date.now(), text: text, checked: false });
            input.value = '';
            save();
            render();
        }

        function del(id) {
            if (confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
                items = items.filter(i => i.id !== id);
                save();
                render();
            }
        }

        function confirmReset() {
            if (confirm('ç¢ºå®šè¦å–æ¶ˆæ‰€æœ‰å‹¾é¸ç‹€æ…‹å—ï¼Ÿ')) {
                items.forEach(i => i.checked = false);
                save();
                render();
            }
        }

        init();
    </script>
</body>
</html>
