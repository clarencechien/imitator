<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººå£æµ·å˜¯ï¼šä¸€å ´å»¶é²åˆ°ä¾†çš„å±æ©Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0a192f;
            color: #e6f1ff;
            overflow-x: hidden;
        }
        .section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            position: relative;
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }
        .section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .card {
            background-color: rgba(23, 42, 70, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.5);
        }
        .highlight { color: #64ffda; }
        .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        /* --- Tsunami Effects --- */
        #tsunami-wrapper {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20%; /* Initial height */
            z-index: 100;
            pointer-events: none;
            transition: height 1.0s ease-out;
        }
        .tsunami-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #wave-body { opacity: 0.65; }
        #wave-body-svg { fill: #172a46; }
        #wave-debris { opacity: 0.4; }
        #wave-crest { height: 50px; bottom: auto; top: -25px; }
        #wave-crest-svg { fill: #ffffff; opacity: 0.7; }
        #content-wrapper { transition: filter 0.5s ease-in-out; }
        .is-shaking { animation: shake 0.8s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }
        
        /* --- Final Message Floating Effect --- */
        #final-message {
            position: fixed;
            z-index: 150; /* Above the tsunami */
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transform: translateY(100vh);
            pointer-events: none;
            transition: opacity 2s ease-out 1s, transform 3s ease-out 1s; /* Delayed transition */
        }
        #final-message.surfaced {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Start Button */
        #start-button-container {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background-color: rgba(10, 25, 47, 0.95);
            z-index: 200;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            cursor: pointer;
        }
        #start-button {
            background-color: #64ffda;
            color: #0a192f;
            border: none; padding: 1rem 2rem; font-size: 1.25rem; font-weight: bold;
            border-radius: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        #start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(100, 255, 218, 0.2);
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <div id="start-button-container">
        <button id="start-button">é–‹å§‹é«”é©—</button>
        <p class="text-slate-400 mt-4">(å»ºè­°é–‹å•ŸéŸ³æ•ˆä»¥ç²å¾—å®Œæ•´é«”é©—)</p>
    </div>

    <div id="content-wrapper" class="relative z-10">
        <div class="container mx-auto px-4">
            <!-- All sections except the last one -->
            <section id="section1" class="section visible">
                <div class="text-center max-w-3xl">
                    <h1 class="text-4xl md:text-6xl font-bold mb-4 text-shadow">äººå£æµ·å˜¯</h1>
                    <p class="text-xl md:text-2xl text-slate-300 text-shadow">ä¸€å ´å»¶é²åˆ°ä¾†çš„å±æ©Ÿ</p>
                    <p class="mt-8 text-lg text-slate-400">å¾ˆå¤šäººé‚„æ²’æ„è­˜åˆ°ï¼Œå°ç£çš„äººå£å±æ©Ÿæ—©å·²å±•é–‹ã€‚å®ƒå°±åƒæµ·å˜¯ï¼Œè¡æ“Šä¸æ˜¯ç¬é–“ç™¼ç”Ÿï¼Œè€Œæ˜¯å…ˆç¶“æ­·ä¸€æ®µçœ‹ä¼¼ç„¡å®³çš„ã€Œé€€æ½®ã€ã€‚</p>
                    <div class="mt-12 animate-bounce">
                        <svg class="w-8 h-8 mx-auto text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                        <p class="text-slate-500 mt-2">å‘ä¸‹æ²å‹•ï¼Œè¦‹è­‰æµªæ½®çš„è®ŠåŒ–</p>
                    </div>
                </div>
            </section>
            <section id="section2" class="section">
                <div class="text-center max-w-4xl w-full">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6 text-shadow">é©Ÿæ¸›çš„å‡ºç”Ÿæ•¸ï¼Œæ˜¯æµ·å˜¯çš„æºé ­</h2>
                    <div class="card rounded-lg p-4 md:p-6 shadow-2xl">
                        <div class="h-[300px] md:h-[500px] w-full"><canvas id="birthChart"></canvas></div>
                        <p class="mt-4 text-slate-300 text-sm md:text-base">åœ¨ <span class="highlight font-bold">2000â€“2005</span> èˆ‡ <span class="highlight font-bold">2016â€“2022</span>ï¼Œå°ç£çš„å‡ºç”Ÿæ•¸å‡ºç¾å…©æ³¢é©Ÿæ¸›ï¼Œæ¯ä¸€æ³¢éƒ½ã€Œç›´æ¥æ‰“ä¸ƒæŠ˜ã€ã€‚å…©æ³¢åŠ ç¸½ï¼Œæ–°ç”Ÿå…’äººæ•¸è¿‘ä¹è…°æ–¬ã€‚</p>
                    </div>
                </div>
            </section>
            <section id="section3" class="section">
                <div class="text-center max-w-3xl">
                    <h2 class="text-3xl md:text-4xl font-bold mb-2 text-shadow">æµ·å˜¯å‰çš„é€€æ½®</h2>
                    <p class="text-lg text-slate-400 mb-10">ç¬¬ä¸€æ³¢è¡æ“Šï¼Œå·²åœ¨æˆ‘å€‘ä¸æ˜“å¯Ÿè¦ºçš„è§’è½ç™¼ç”Ÿã€‚</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸ“</div><h3 class="text-xl font-bold mb-2">è£œç¿’ç­å€’é–‰æ½®</h3><p class="text-slate-400">å­¸ç”Ÿæ•¸æŒçºŒä¸‹æ»‘ï¼Œæ‹›ç”Ÿä¸€å¹´æ¯”ä¸€å¹´å›°é›£ã€‚</p></div>
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸ¢</div><h3 class="text-xl font-bold mb-2">éŠæ¨‚åœ’ç©ºè•©è•©</h3><p class="text-slate-400">å…¥åœ’äººæ•¸ä¸€è·¯å¢œè½ï¼Œå¹³æ—¥ç”šè‡³é¡¯å¾—è•­æ¢ã€‚</p></div>
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸ«</div><h3 class="text-xl font-bold mb-2">å¤§å­¸é€€å ´</h3><p class="text-slate-400">2000å¹´å¾Œå‡ºç”Ÿçš„å­©å­æ­£å€¼å¤§å­¸å¹´é½¡ï¼Œæ‹›ç”Ÿç¼ºé¡å·²æˆå¸¸æ…‹ã€‚</p></div>
                    </div>
                </div>
            </section>
            <section id="section4" class="section">
                <div class="text-center max-w-3xl">
                     <div class="w-24 h-24 mx-auto mb-6 flex items-center justify-center rounded-full bg-red-500/20 border-2 border-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg></div>
                    <h2 class="text-3xl md:text-4xl font-bold mb-4 text-shadow">ç¬¬ä¸€æ³¢æµ·å˜¯ï¼šå¤§ç¼ºå·¥æ™‚ä»£</h2>
                    <p class="text-lg text-slate-300">ç¬¬ä¸€æ³¢å‡ºç”Ÿé©Ÿæ¸›çš„å­©å­å€‘å·²å¤§å­¸ç•¢æ¥­ï¼Œæ­£é€²å…¥å‹å‹•å¸‚å ´ã€‚</p>
                    <p class="mt-6 text-xl text-amber-400 font-bold bg-amber-400/10 px-4 py-2 rounded-md">çµæœå°±æ˜¯ï¼šå„è¡Œå„æ¥­éƒ½åœ¨å–Šç¼ºå·¥ã€‚</p>
                    <p class="mt-6 text-slate-400">éå»é‚£ç¨®è•­æ¢èˆ‡çµ•æœ›æ„Ÿï¼Œæ­£å¾æ•™è‚²ã€å¨›æ¨‚ç”¢æ¥­ï¼Œé€æ¼¸è”“å»¶åˆ°æ‰€æœ‰ç”¢æ¥­ã€‚</p>
                </div>
            </section>
            <section id="section5" class="section">
                <div class="text-center max-w-4xl">
                    <h2 class="text-3xl md:text-4xl font-bold mb-4 text-shadow">æˆ¿å¸‚çš„å¯§éœï¼Œåªæ˜¯å‡è±¡</h2>
                     <p class="text-lg text-slate-400 mb-10">ç‚ºä»€éº¼è¡æ“Šé‚„æ²’è”“å»¶åˆ°æˆ¿åœ°ç”¢ï¼Ÿå› ç‚ºä¸»åŠ›å®¢ç¾¤çš„å¹´é½¡é‚„æ²’åˆ°ã€‚</p>
                    <div class="card rounded-lg p-6 md:p-8 shadow-2xl flex flex-col md:flex-row items-center gap-8">
                        <div class="text-center"><p class="text-6xl md:text-8xl font-bold highlight">30-40</p><p class="text-xl text-slate-300">æ­²</p><p class="mt-2 text-slate-400">è²·æˆ¿ä¸»åŠ›èˆ‡å‰›æ€§éœ€æ±‚</p></div>
                        <div class="text-left flex-1 border-l-4 border-sky-500 pl-6"><p class="text-lg mb-4">ç›®å‰ï¼Œé€™å€‹å¹´é½¡å±¤çš„äººï¼Œå¤§å¤šæ˜¯åœ¨ <span class="highlight">1985-1995</span> å¹´å‡ºç”Ÿï¼Œé‚£æ™‚å°ç£æ¯å¹´é‚„æœ‰ <span class="highlight">30-40è¬</span> æ–°ç”Ÿå…’ã€‚</p><p class="text-lg mb-4">ä½†å¹¾å¹´å¾Œï¼Œè¼ªåˆ° <span class="font-bold text-red-400">2000</span> å¹´å¾Œå‡ºç”Ÿçš„ã€Œ<span class="font-bold text-red-400">ä¸ƒæŠ˜ä¸–ä»£</span>ã€é€²å…¥é€™å€‹å€é–“æ™‚ï¼ŒçœŸæ­£çš„æµ·å˜¯æ‰æœƒè¡å‘æˆ¿åœ°ç”¢ã€‚</p><p class="text-lg">éå»ã€Œæˆ¿åƒ¹åªæ¼²ä¸è·Œã€çš„ç¥è©±å»ºç«‹åœ¨äººå£æŒçºŒå¢åŠ çš„åŸºç¤ä¸Šï¼›ç•¶åŸºç¤ä¸å†ï¼Œæœªä¾†çš„èµ°å‹¢å°±ä¸å¯èƒ½å¦‚éå¾€ã€‚</p></div>
                    </div>
                </div>
            </section>
            <section id="section6" class="section">
                <div class="text-center max-w-3xl">
                     <div class="w-24 h-24 mx-auto mb-6 flex items-center justify-center rounded-full bg-red-500/20 border-2 border-red-500 animate-pulse"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
                    <h2 class="text-3xl md:text-4xl font-bold mb-4 text-shadow">æ›´å¤§çš„æµªï¼Œé‚„åœ¨åœ°å¹³ç·šä¸Š</h2>
                    <p class="text-lg text-slate-300">éºæ†¾çš„æ˜¯ï¼Œé€™åªæ˜¯ç¬¬ä¸€æ³¢è¡æ“Šã€‚</p><p class="mt-6 text-xl text-red-400 font-bold bg-red-400/10 px-4 py-2 rounded-md">2016å¹´å¾Œæ›´çŒ›çƒˆçš„ã€Œç¬¬äºŒæ³¢äººå£æµ·å˜¯ã€é‚„åœ¨å¾Œé ­ã€‚</p><p class="mt-6 text-slate-400">ç•¶éœ€æ±‚çš„æ ¸å¿ƒï¼ˆäººå£ï¼‰æŒçºŒèç¸®ï¼Œæ²’æœ‰ä»»ä½•è³‡ç”¢èƒ½æ°¸é é•æŠ—åœ°å¿ƒå¼•åŠ›ã€‚</p>
                </div>
            </section>
            <section id="section7" class="section">
                <div class="text-center max-w-5xl">
                    <h2 class="text-3xl md:text-4xl font-bold mb-2 text-shadow">ä»¥æ—¥æœ¬ç‚ºé¡ï¼šå°ç£ 2025-2050 çš„æœªä¾†é æƒ³åœ–</h2>
                    <p class="text-lg text-slate-400 mb-10">æ—¥æœ¬èµ°éçš„è·¯ï¼Œæ˜¯æˆ‘å€‘æœ€æ¸…æ™°çš„å€Ÿé¡ã€‚ä»¥ä¸‹ç¾è±¡ï¼Œå°‡ä¸åƒ…æ˜¯è¶¨å‹¢ï¼Œè€Œæ˜¯æœªä¾†äºŒåå¹´çš„æ—¥å¸¸ã€‚</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸšï¸</div><h3 class="text-xl font-bold mb-2">ã€Œå¹½éˆç¤¾å€ã€èˆ‡åœ°æ–¹è•­æ¢</h3><p class="text-slate-400">é„‰é®äººå£å¤–ç§»ã€å¸‚ä¸­å¿ƒç©ºå±‹ç‡æ”€å‡ï¼ŒåŸºç¤è¨­æ–½çš„ç¶­è­·æˆæœ¬å°‡æˆç‚ºæ²ˆé‡è² æ“”ã€‚</p></div>
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸ¤–</div><h3 class="text-xl font-bold mb-2">ã€Œç„¡äººåŒ–ã€ç§‘æŠ€åŠ é€Ÿæ™®åŠ</h3><p class="text-slate-400">ç‚ºè§£æ±ºç¼ºå·¥å•é¡Œï¼Œå¾é¤å»³åˆ°å·¥å» ï¼Œè‡ªå‹•åŒ–ã€AIå®¢æœã€é€é¤æ©Ÿå™¨äººå°‡ç„¡æ‰€ä¸åœ¨ã€‚</p></div>
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸ‘µ</div><h3 class="text-xl font-bold mb-2">ã€ŒéŠ€é«®å‹å‹•åŠ›ã€æˆç‚ºå¸¸æ…‹</h3><p class="text-slate-400">æ³•å®šé€€ä¼‘å¹´é½¡è¢«è¿«å»¶å¾Œï¼Œ70æ­²çš„è¨ˆç¨‹è»Šå¸æ©Ÿã€æœå‹™ç”Ÿå°‡ä¸å†æ˜¯æ–°èã€‚</p></div>
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸª</div><h3 class="text-xl font-bold mb-2">æ¶ˆè²»å¸‚å ´çµæ§‹è½‰è®Š</h3><p class="text-slate-400">ã€ŒéŠ€é«®ç¶“æ¿Ÿã€èˆ‡ã€Œå–®èº«ç¶“æ¿Ÿã€å´›èµ·ï¼Œå•†å“è¨­è¨ˆã€é€šè·¯èˆ‡æœå‹™éƒ½å°‡éš¨ä¹‹è®Šé©ã€‚</p></div>
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸ’¼</div><h3 class="text-xl font-bold mb-2">ä¸­å°ä¼æ¥­ã€Œç¹¼æ‰¿è€…å±æ©Ÿã€</h3><p class="text-slate-400">è¨±å¤šæ“æœ‰æ•¸åå¹´æŠ€è¡“çš„ä¸­å°ä¼æ¥­ï¼Œå› æ‰¾ä¸åˆ°æ¥ç­äººè€Œè¢«è¿«é—œé–‰æˆ–è¢«ä½µè³¼ã€‚</p></div>
                        <div class="card rounded-lg p-6 text-center"><div class="text-5xl mb-4">ğŸ’¸</div><h3 class="text-xl font-bold mb-2">ç¤¾æœƒä¿éšœé«”ç³»å£“åŠ›åŠ‡å¢</h3><p class="text-slate-400">é ˜å–å¹´é‡‘çš„äººè®Šå¤šã€ç¹³ç´ä¿è²»çš„å¹´è¼•äººè®Šå°‘ï¼Œå¥ä¿èˆ‡å‹ä¿çš„è²¡å‹™ç¼ºå£å°‡æ›´åš´å³»ã€‚</p></div>
                    </div>
                </div>
            </section>
            <div style="height: 50vh;"></div>
        </div>
    </div>

    <div id="final-message">
        <div class="text-center max-w-3xl p-4">
            <h2 class="text-4xl md:text-5xl font-bold mb-4 text-shadow">æµªæ½®å·²è‡³ï¼Œæˆ‘å€‘å¦‚ä½•æ‡‰å°ï¼Ÿ</h2>
            <p class="text-xl text-slate-300">äººå£çµæ§‹çš„æ”¹è®Šç„¡æ³•é€†è½‰ï¼Œä½†æ‡‰å°çš„æ–¹å¼æŒæ¡åœ¨æˆ‘å€‘æ‰‹ä¸­ã€‚</p>
            <p class="mt-8 text-lg text-slate-400">å¾å€‹äººè·æ¶¯è¦åŠƒã€ä¼æ¥­è½‰å‹ï¼Œåˆ°åœ‹å®¶æ”¿ç­–çš„ä½ˆå±€ï¼Œéƒ½éœ€è¦å…¨æ–°çš„æ€ç¶­ã€‚</p>
            <p class="mt-6 text-2xl font-bold highlight">æœªä¾†ä¸¦éæ³¨å®šï¼Œæ”¹è®Šçš„å¥‘æ©Ÿå°±åœ¨ç•¶ä¸‹ã€‚</p>
        </div>
    </div>

    <div id="tsunami-wrapper">
        <div id="wave-debris" class="tsunami-layer">
            <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="debrisPattern" patternUnits="userSpaceOnUse" width="400" height="400">
                        <g fill="rgba(0,0,0,0.5)">
                            <path d="M50 0 L120 10 L110 25 L40 30 Z" transform="rotate(15) scale(0.8)"/>
                            <rect x="200" y="150" width="80" height="20" transform="rotate(-25)"/>
                            <circle cx="300" cy="300" r="15"/>
                            <path d="M150 250 L220 260 L210 275 L140 280 Z" transform="rotate(45) scale(1.2)"/>
                        </g>
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#debrisPattern)"/>
            </svg>
        </div>
        <div id="wave-body" class="tsunami-layer">
            <svg id="wave-body-svg" class="w-full h-full" viewBox="0 0 1440 320" preserveAspectRatio="none"><path d="M0,160L48,176C96,192,192,224,288,213.3C384,203,480,149,576,133.3C672,117,768,139,864,165.3C960,192,1056,224,1152,218.7C1248,213,1344,171,1392,149.3L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>
        </div>
        <div id="wave-crest" class="tsunami-layer">
            <svg id="wave-crest-svg" class="w-full h-full" viewBox="0 0 1440 50" preserveAspectRatio="none"><path d="M0,25 C200,50 350,0 500,25 C650,50 800,0 950,25 C1100,50 1250,0 1440,25 L1440,50 L0,50 Z"></path></svg>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('.section');
            const tsunamiWrapper = document.getElementById('tsunami-wrapper');
            const contentWrapper = document.getElementById('content-wrapper');
            const finalMessage = document.getElementById('final-message');
            const debrisPattern = document.getElementById('debrisPattern');
            const startButtonContainer = document.getElementById('start-button-container');
            let audioStarted = false;
            let rumble, impact;
            let finalImpactTriggered = false; // Flag to ensure final impact happens only once

            function setupAudio() {
                if (audioStarted) return;
                Tone.start();
                rumble = new Tone.NoiseSynth({ noise: { type: 'brown' }, envelope: { attack: 4, decay: 0.1, sustain: 1, release: 4 } }).toDestination();
                rumble.volume.value = -25;
                impact = new Tone.MembraneSynth({ pitchDecay: 0.08, octaves: 10, oscillator: { type: 'sine' }, envelope: { attack: 0.001, decay: 0.8, sustain: 0.01, release: 1.4, attackCurve: 'exponential' } }).toDestination();
                impact.volume.value = -3;
                audioStarted = true;
            }

            startButtonContainer.addEventListener('click', () => {
                setupAudio();
                startButtonContainer.style.transition = 'opacity 0.5s ease';
                startButtonContainer.style.opacity = '0';
                setTimeout(() => startButtonContainer.style.display = 'none', 500);
                if(rumble) rumble.triggerAttack();
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
            }, { root: null, rootMargin: '0px', threshold: 0.2 });
            sections.forEach(section => observer.observe(section));

            function animateTsunami() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrollPercentage = (scrollTop / scrollHeight);

                let waveHeight;
                if (scrollPercentage < 0.15) waveHeight = 20;
                else if (scrollPercentage < 0.4) waveHeight = 20 - (scrollPercentage - 0.15) * 60;
                else if (scrollPercentage < 0.9) waveHeight = 5 + ((scrollPercentage - 0.4) / 0.5) * 85;
                else waveHeight = 90 + ((scrollPercentage - 0.9) / 0.1) * 10;
                const currentWaveHeight = Math.max(5, Math.min(100, waveHeight));
                tsunamiWrapper.style.height = `${currentWaveHeight}%`;
                
                if(audioStarted) rumble.volume.value = -25 + (currentWaveHeight / 100) * 15;

                const xOffset = Math.sin(scrollTop * 0.01) * 200;
                const yOffset = Math.cos(scrollTop * 0.007) * 200;
                debrisPattern.setAttribute('x', xOffset);
                debrisPattern.setAttribute('y', yOffset);

                const waveCrestPosition = tsunamiWrapper.offsetTop;
                const submersionDepth = Math.max(0, window.innerHeight - waveCrestPosition - 50);
                const submersionFactor = Math.min(1, submersionDepth / (window.innerHeight * 0.9));

                let blurValue = 0;
                let brightnessValue = 1;

                if (scrollPercentage < 0.95) {
                    blurValue = submersionFactor * 1.5;
                    brightnessValue = 1 - (submersionFactor * 0.2);
                    if (finalImpactTriggered) { // Reset if user scrolls back up
                        finalImpactTriggered = false;
                        finalMessage.classList.remove('surfaced');
                    }
                } else {
                    const finalFactor = (scrollPercentage - 0.95) / 0.05;
                    blurValue = 1.5 + finalFactor * 8.5;
                    brightnessValue = 0.8 - finalFactor * 0.55;
                    
                    if (!finalImpactTriggered) {
                        finalImpactTriggered = true; // Set flag
                        document.body.classList.add('is-shaking');
                        if(audioStarted) impact.triggerAttackRelease("C1", "2n");
                        setTimeout(() => {
                            document.body.classList.remove('is-shaking');
                        }, 800);
                        // Trigger final message surfacing with the impact
                        finalMessage.classList.add('surfaced');
                    }
                }
                contentWrapper.style.filter = `blur(${blurValue}px) brightness(${brightnessValue})`;

                requestAnimationFrame(animateTsunami);
            }
            requestAnimationFrame(animateTsunami);

            const ctx = document.getElementById('birthChart').getContext('2d');
            const years = ['1980', '1981', '1982', '1983', '1984', '1985', '1986', '1987', '1988', '1989', '1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023'];
            const births = [414, 414, 407, 399, 382, 375, 348, 315, 342, 335, 335, 321, 326, 327, 329, 323, 326, 327, 278, 284, 305, 260, 247, 227, 216, 205, 204, 203, 198, 191, 166, 196, 229, 199, 210, 213, 193, 193, 181, 177, 165, 153, 138, 147];
            const backgroundColors = years.map(year => { const y = parseInt(year); return ((y >= 2000 && y <= 2005) || (y >= 2016 && y <= 2022)) ? 'rgba(239, 68, 68, 0.6)' : 'rgba(56, 189, 248, 0.6)'; });
            const borderColors = years.map(year => { const y = parseInt(year); return ((y >= 2000 && y <= 2005) || (y >= 2016 && y <= 2022)) ? 'rgba(239, 68, 68, 1)' : 'rgba(56, 189, 248, 1)'; });
            new Chart(ctx, { type: 'bar', data: { labels: years, datasets: [{ label: 'æ¯å¹´æ–°ç”Ÿå…’æ•¸ (åƒäºº)', data: births, backgroundColor: backgroundColors, borderColor: borderColors, borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(23, 42, 70, 0.9)', titleColor: '#e6f1ff', bodyColor: '#e6f1ff', callbacks: { label: (context) => ` ${context.parsed.y} åƒäºº` } } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(100, 116, 139, 0.2)' }, ticks: { color: '#94a3b8', callback: (value) => value + 'k' }, title: { display: true, text: 'æ–°ç”Ÿå…’æ•¸ (åƒäºº)', color: '#94a3b8' } }, x: { grid: { display: false }, ticks: { color: '#94a3b8', maxRotation: 90, minRotation: 70, autoSkip: true, maxTicksLimit: 20 } } } } });
        });
    </script>

</body>
</html>
